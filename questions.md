## 1. 为什么 augment_data 之后有些 labels 会变成全空

随机裁剪，刚刚好裁剪到全空的背景。**注意**：不是雄蕊部分的细胞也是背景，所以有可能全图中只有一小块雄蕊，那大概率裁剪到全空的背景。

## 2. 需要做交互式的吗

也就是使用用户界面、prompt和持续学习

## 3. 数据问题

原始数据中存在大量没有分割开的数据，还有没有标注的数据（最初和最后几张尤为明显，甚至影响到了f1等，使用mask？）
才发现我用的原始数据不是我标注的，而是通过模型处理的，那就很尴尬了。

## 实例分割的测试结果

使用 004 作为训练数据，003 作为测试数据。

| acc    | prec   | recall | f1     | voi    |
|--------|--------|--------|--------|--------|
| 0.8209 | 0.9673 | 0.8051 | 0.8787 | 1.1350 |



## 液泡和细胞核数据

1 - 液泡
2 - 核质
3 - 核仁

## 实例分割的 Loss 设计

```loss = loss1 + loss2 * WEIGHT_LOSS2 + loss3 * WEIGHT_LOSS3```

- loss1 = F.binary_cross_entropy(output_y_mask, gt_binary_mask)

- loss2 = Diceloss_fn(1 - output_y_mask_, 1 - gt_binary_mask)

- loss3 = torch.sum(output_y_mask * gt_affinity) / torch.sum(gt_affinity)

- loss3 的设计初衷：gt_affinity 为 1 的地方是实例边界，这个位置上对应的 output_y_mask 应该尽可能接近 0 代表这是背景。

## 如何调整为语义分割

### 1. 先不调整，转化为实例分割

假设要分割 1-液泡，那么在 gt_labels 中把不是 1 的值变成 0，也就是忽略细胞核。

由于属于液泡的像素占比太少，需要给前景增加一个 weight，设置为 背景像素数/液泡像素数。

同时提高 loss2 的权重。

| acc    | prec   | recall | f1     | voi    |
|--------|--------|--------|--------|--------|
| 0.9645 | 0.6191 | 0.6985 | 0.6561 | 0.3588 |
| 0.9666 | 0.6620 | 0.6887 | 0.6747 | 0.3345 |
| 0.9582 | 0.5671 | 0.7190 | 0.6338 | 0.3909 |
| 0.9584 | 0.5764 | 0.6499 | 0.6107 | 0.3896 |

为什么 acc 高：因为大部分都是背景，模型只要输出 0 准确率就能很高。
